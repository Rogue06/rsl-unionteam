<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNION TEAM - Dashboard S√©curis√©</title>
    <style>
        :root {
            --bg-darker: #1e1f22; --bg-main: #2b2d31; --bg-preview: #313338;
            --text-white: #ffffff; --text-main: #dbdee1; --text-muted: #949ba4;
            --accent-discord: #5865f2; --success-green: #248046; --warning-orange: #f0b232; --danger: #f23f43;
        }

        body, html { margin: 0; padding: 0; height: 100%; font-family: "gg sans", sans-serif; background-color: var(--bg-main); color: var(--text-main); overflow: hidden; }
        header { background-color: var(--bg-darker); height: 70px; display: flex; align-items: center; justify-content: space-between; padding: 0 25px; border-bottom: 2px solid #1a1b1e; }
        
        .container { display: flex; height: calc(100% - 70px); }
        .editor-zone { flex: 1.1; background-color: var(--bg-darker); padding: 20px; overflow-y: auto; border-right: 1px solid #1a1b1e; }
        .preview-zone { flex: 0.9; background-color: var(--bg-preview); padding: 25px; overflow-y: auto; scroll-behavior: smooth; position: relative; }

        .clan-card { background: #2b2d31; border-radius: 8px; padding: 18px; margin-bottom: 20px; border: 1px solid #3f4147; }
        .clan-card h3 { margin: 0 0 15px 0; font-size: 13px; color: var(--warning-orange); text-transform: uppercase; }
        
        .grid-inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
        .field { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 10px; font-weight: 800; color: var(--text-muted); text-transform: uppercase; }
        
        input { background: #1e1f22; border: 1px solid #1a1b1e; border-radius: 4px; padding: 8px; color: white; font-size: 13px; outline: none; }
        input:focus { border-color: var(--accent-discord); }

        .hl-active { background-color: rgba(240, 178, 50, 0.8) !important; color: black !important; font-weight: bold; border-radius: 3px; padding: 0 2px; }

        .btn-group { display: flex; gap: 8px; flex-wrap: wrap; }
        button { padding: 8px 14px; border-radius: 4px; border: none; font-weight: 600; cursor: pointer; font-size: 11px; display: flex; align-items: center; gap: 6px; transition: 0.2s; }
        .btn-blue { background-color: var(--accent-discord); color: white; }
        .btn-green { background-color: var(--success-green); color: white; }
        .btn-gray { background: #4f545c; color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--text-muted); color: var(--text-muted); }
        .btn-split { background: #eb459e; color: white; }

        .char-counter { position: sticky; top: -25px; background: var(--bg-preview); padding: 10px; font-weight: bold; border-bottom: 1px solid #4e5058; margin-bottom: 15px; z-index: 10; display: flex; justify-content: space-between; }
        .limit-ok { color: var(--success-green); }
        .limit-bad { color: var(--danger); }

        .discord-mockup { font-size: 15px; line-height: 1.5; white-space: pre-wrap; color: #dbdee1; padding-bottom: 100px; }
        .discord-mockup strong { color: #fff; }
        .discord-mockup hr { border: none; border-top: 1px solid #4e5058; margin: 25px 0; }

        #copy-toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--success-green); color: white; padding: 12px 25px; border-radius: 8px; opacity: 0; transition: 0.4s; z-index: 5000; pointer-events: none; }
        #expertMode { display: none; width: 100%; height: 85%; background: #232428; color: #dcddde; font-family: monospace; padding: 15px; border-radius: 8px; resize: none; border: 1px solid #1a1b1e; }
        
        #helpModal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 6000; }
        .modal-content { background: var(--bg-main); padding: 30px; border-radius: 12px; max-width: 500px; }
    </style>
</head>
<body>

<header>
    <div style="font-weight: 800; color: white;">üõ°Ô∏è DASHBOARD UNION TEAM</div>
    <div class="btn-group">
        <button class="btn-outline" onclick="toggleHelp()">‚ùì Aide</button>
        <button class="btn-gray" onclick="confirmReset()">üîÑ Reset</button>
        <div style="width: 2px; height: 30px; background: #4e5058; margin: 0 5px;"></div>
        
        <button class="btn-blue" id="btn-copy-full" onclick="copyAction('pure')">üöÄ Copier Tout</button>
        <button class="btn-green" id="btn-share-full" onclick="copyAction('friend')">üë• Partager Tout</button>
        
        <button class="btn-split" id="btn-p1" style="display:none" onclick="copySplit(1)">‚úÇÔ∏è Copier P1 (Gold/Silver)</button>
        <button class="btn-split" id="btn-p2" style="display:none" onclick="copySplit(2)">‚úÇÔ∏è Copier P2 (Savage/Bronze)</button>
    </div>
</header>

<div class="container">
    <div class="editor-zone">
        <button id="toggleBtn" class="btn-toggle" style="background:#4f545c; color:white; width:100%; padding:10px; margin-bottom:20px; border:1px dashed #949ba4; cursor:pointer;" onclick="toggleMode()">‚öôÔ∏è Mode Texte Libre</button>
        
        <div id="formMode">
            <div class="clan-card" onfocusin="syncFocus('preview_gold')">
                <h3>üî• UNION TEAM GOLD</h3>
                <div class="grid-inputs">
                    <div class="field"><label>BDC</label><input type="text" id="g_bdc" data-base="UNM / NM / Brutal"></div>
                    <div class="field"><label>Hydre</label><input type="text" id="g_hy" data-base="Normal / Difficile / Brutal / Cauchemar"></div>
                    <div class="field"><label>Chim√®re</label><input type="text" id="g_ch" data-base="Difficile / Cauchemar / UNM"></div>
                    <div class="field"><label>CvC (RP/NRP)</label><input type="text" id="g_cvc" data-base="150k RP / 80k NRP"></div>
                    <div class="field"><label>Clash Hydre</label><input type="text" id="g_chy" data-base="650M"></div>
                    <div class="field"><label>Clash Chim√®re</label><input type="text" id="g_cch" data-base="500M"></div>
                    <div class="field"><label>Places</label><input type="text" id="g_pl" data-base="√† d√©terminer"></div>
                </div>
            </div>

            <div class="clan-card" onfocusin="syncFocus('preview_silver')">
                <h3>‚öîÔ∏è UNION TEAM SILVER</h3>
                <div class="grid-inputs">
                    <div class="field"><label>BDC</label><input type="text" id="s_bdc" data-base="UNM / NM"></div>
                    <div class="field"><label>Hydre</label><input type="text" id="s_hy" data-base="Normal / Difficile / Brutal"></div>
                    <div class="field"><label>Chim√®re</label><input type="text" id="s_ch" data-base="Facile / Difficile"></div>
                    <div class="field"><label>CvC (RP/NRP)</label><input type="text" id="s_cvc" data-base="100k RP / 50k NRP"></div>
                    <div class="field"><label>Clash Hydre</label><input type="text" id="s_chy" data-base="50M"></div>
                    <div class="field"><label>Clash Chim√®re</label><input type="text" id="s_cch" data-base=""></div>
                    <div class="field"><label>Places</label><input type="text" id="s_pl" data-base="√† d√©terminer"></div>
                </div>
            </div>

            <div class="clan-card" onfocusin="syncFocus('preview_savage')">
                <h3>üî• UNION TEAM SAVAGE</h3>
                <div class="grid-inputs">
                    <div class="field"><label>BDC</label><input type="text" id="sv_bdc" data-base="UNM / NM"></div>
                    <div class="field"><label>Hydre</label><input type="text" id="sv_hy" data-base="Normal / Difficile / Brutal / Cauchemar"></div>
                    <div class="field"><label>Chim√®re</label><input type="text" id="sv_ch" data-base="Difficile / Cauchemar"></div>
                    <div class="field"><label>CvC (RP/NRP)</label><input type="text" id="sv_cvc" data-base="80k RP / 50k NRP"></div>
                    <div class="field"><label>Clash Hydre</label><input type="text" id="sv_chy" data-base="80M"></div>
                    <div class="field"><label>Clash Chim√®re</label><input type="text" id="sv_cch" data-base="100M"></div>
                    <div class="field"><label>Places</label><input type="text" id="sv_pl" data-base="2 √† 3 places"></div>
                </div>
            </div>

            <div class="clan-card" onfocusin="syncFocus('preview_bronze')">
                <h3>ü•â UNION TEAM BRONZE</h3>
                <div class="grid-inputs">
                    <div class="field"><label>BDC</label><input type="text" id="b_bdc" data-base="UNM / NM / Brutal"></div>
                    <div class="field"><label>Hydre</label><input type="text" id="b_hy" data-base="Normal"></div>
                    <div class="field"><label>Chim√®re</label><input type="text" id="b_ch" data-base=""></div>
                    <div class="field"><label>CvC (RP/NRP)</label><input type="text" id="b_cvc" data-base="40k RP / 20k NRP"></div>
                    <div class="field"><label>Clash Hydre</label><input type="text" id="b_chy" data-base=""></div>
                    <div class="field"><label>Clash Chim√®re</label><input type="text" id="b_cch" data-base=""></div>
                    <div class="field"><label>Places</label><input type="text" id="b_pl" data-base="2 places dispo !"></div>
                </div>
            </div>
        </div>
        <textarea id="expertMode"></textarea>
    </div>

    <div class="preview-zone">
        <div class="char-counter">
            <span>Taille : <span id="charCount">0</span> / 2000</span>
            <span id="limitStatus"></span>
        </div>
        <div id="visualPreview" class="discord-mockup"></div>
    </div>
</div>

<div id="helpModal">
    <div class="modal-content">
        <h2>‚ÑπÔ∏è Gestion des 2000 caract√®res</h2>
        <p>Discord limite les messages √† <b>2000 caract√®res</b> (hors Nitro).</p>
        <p>‚Ä¢ <b>Compteur Vert</b> : Tout va bien, utilisez le bouton bleu ou vert.</p>
        <p>‚Ä¢ <b>Compteur Rouge</b> : Le message est trop long. L'outil fera appara√Ætre deux boutons roses pour poster l'annonce en 2 messages s√©par√©s.</p>
        <button class="btn-blue" onclick="toggleHelp()" style="width:100%; justify-content:center">OK</button>
    </div>
</div>

<div id="copy-toast">Copi√© !</div>

<script>
let currentMode = "form";
let activeFieldId = null;

function build() {
    if(currentMode !== "form") return;
    const raw = generateContent(false);
    document.getElementById('expertMode').value = raw;
    
    // Check limit
    const len = raw.length;
    const countEl = document.getElementById('charCount');
    const statusEl = document.getElementById('limitStatus');
    countEl.innerText = len;
    
    if(len > 2000) {
        countEl.className = 'limit-bad';
        statusEl.innerHTML = "‚ö†Ô∏è Trop long pour Nitro !";
        document.getElementById('btn-p1').style.display = 'flex';
        document.getElementById('btn-p2').style.display = 'flex';
    } else {
        countEl.className = 'limit-ok';
        statusEl.innerHTML = "‚úÖ Ok pour Discord";
        document.getElementById('btn-p1').style.display = 'none';
        document.getElementById('btn-p2').style.display = 'none';
    }

    renderPreview(generateContent(true));
}

function generateContent(isHtml) {
    const clans = [
        { id: 'g', name: 'GOLD', emoji: ':fire:' },
        { id: 's', name: 'SILVER', emoji: ':crossed_swords:' },
        { id: 'sv', name: 'SAVAGE', emoji: ':fire:' },
        { id: 'b', name: 'BRONZE', emoji: ':third_place:' }
    ];

    let t = `:dart: **[FR] L‚ÄôAlliance UNION TEAM Recrute !** :dart:\nNotre Union poss√®de **3 clans : Bronze ‚Üí Silver ‚Üí Gold**.\n\n`;

    clans.forEach((c, idx) => {
        const bdc = getVal(c.id+'_bdc', isHtml);
        const hy = getVal(c.id+'_hy', isHtml);
        const ch = getVal(c.id+'_ch', isHtml);
        const cvc = getVal(c.id+'_cvc', isHtml);
        const chy = getVal(c.id+'_chy', isHtml);
        const cch = getVal(c.id+'_cch', isHtml);
        const pl = getVal(c.id+'_pl', isHtml);

        if(idx === 2) t += "%%%SPLIT%%%"; // Marqueur pour diviser en deux parties

        t += `‚∏ª\n\n${c.emoji}** UNION TEAM ${c.name} **\n`;
        if(bdc) t += `:boom: BDC : ${bdc} ‚Üí tombent tous les jours\n`;
        if(hy)  t += `:dragon: **Hydre** : ${hy}\n`;
        if(ch)  t += `:smiling_imp: **Chim√®re** : ${ch} tombent\n`;
        t += `\n:heavy_check_mark: **Exigences :**\n`;
        if(c.id !== 'b') t += `‚Ä¢ Frapper **BDC UNM**\n`;
        if(cvc) t += `‚Ä¢ **${cvc}** en CvC\n`;
        if(chy) t += `‚Ä¢ Quotas Clash Hydre **${chy}**\n`;
        if(cch) t += `‚Ä¢ Quotas Clash Chim√®re **${cch}**\n`;
        t += c.id === 'b' ? `‚Ä¢ Motivation Evolution\n` : `‚Ä¢ Activit√© Discord\n`;
        if(pl)  t += `:pushpin: ** Places **: ${pl}\n\n`;
    });

    t += `‚∏ª\n:gift: **Pourquoi nous rejoindre ?**\n:heavy_check_mark: Communaut√© soud√©e\n:heavy_check_mark: Strats partag√©es\n:heavy_check_mark: Discord actif\n\n:envelope_with_arrow: **MP pour postuler !** :muscle:`;
    return isHtml ? t.replace("%%%SPLIT%%%", "") : t;
}

function getVal(id, isHtml) {
    const val = document.getElementById(id).value.trim();
    if(!val) return null;
    return (isHtml && id === activeFieldId) ? `<span class="hl-active">${val}</span>` : val;
}

function copySplit(part) {
    const fullText = document.getElementById('expertMode').value;
    const parts = fullText.split("%%%SPLIT%%%");
    let textToCopy = (part === 1) ? parts[0] : parts[1];
    
    // On nettoie les tags et on ajoute un petit header pour la P2
    if(part === 2) textToCopy = "*(Suite de l'annonce)*\n" + textToCopy;
    
    navigator.clipboard.writeText(textToCopy);
    showToast(`Partie ${part} copi√©e !`);
}

function renderPreview(content) {
    const emojiMap = { ":dart:":"üéØ", ":fire:":"üî•", ":boom:":"üí•", ":dragon:":"üêâ", ":smiling_imp:":"üòà", ":heavy_check_mark:":"‚úîÔ∏è", ":pushpin:":"üìå", ":crossed_swords:":"‚öîÔ∏è", ":third_place:":"ü•â", ":punch:":"üëä", ":gift:":"üéÅ", ":envelope_with_arrow:":"üì©", ":muscle:":"üí™" };
    let html = content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/‚∏ª/g, '<hr>');
    html = html.replace("UNION TEAM GOLD", '<span id="preview_gold">UNION TEAM GOLD</span>')
               .replace("UNION TEAM SILVER", '<span id="preview_silver">UNION TEAM SILVER</span>')
               .replace("UNION TEAM SAVAGE", '<span id="preview_savage">UNION TEAM SAVAGE</span>')
               .replace("UNION TEAM BRONZE", '<span id="preview_bronze">UNION TEAM BRONZE</span>');
    for (const [code, icon] of Object.entries(emojiMap)) { html = html.split(code).join(icon); }
    document.getElementById('visualPreview').innerHTML = html;
}

function syncFocus(id) { document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
function confirmReset() { if(confirm("R√©initialiser ?")) { applyDefaults(); } }
function applyDefaults() { document.querySelectorAll('input').forEach(i => { i.value = i.getAttribute('data-base') || ""; }); build(); }
function toggleHelp() { const m = document.getElementById('helpModal'); m.style.display = m.style.display === 'flex' ? 'none' : 'flex'; }

function toggleMode() {
    const f = document.getElementById('formMode'), e = document.getElementById('expertMode'), b = document.getElementById('toggleBtn');
    if(currentMode === "form") { f.style.display = "none"; e.style.display = "block"; b.innerText = "üìù Formulaire"; currentMode = "expert"; }
    else { f.style.display = "block"; e.style.display = "none"; b.innerText = "‚öôÔ∏è Texte Libre"; currentMode = "form"; build(); }
}

function copyAction(type) {
    let text = document.getElementById('expertMode').value.replace("%%%SPLIT%%%", "");
    if(type === 'friend') text = "```js\n" + text + "\n```";
    navigator.clipboard.writeText(text);
    showToast("Annonce compl√®te copi√©e !");
}

function showToast(txt) {
    const t = document.getElementById('copy-toast'); t.innerText = txt; t.style.opacity = '1';
    setTimeout(() => t.style.opacity = '0', 2000);
}

document.querySelectorAll('input').forEach(input => {
    input.addEventListener('input', (e) => { activeFieldId = e.target.id; build(); });
    input.addEventListener('focus', (e) => { activeFieldId = e.target.id; build(); });
    input.addEventListener('blur', () => { activeFieldId = null; build(); });
});

window.onload = applyDefaults;
</script>
</body>
</html>