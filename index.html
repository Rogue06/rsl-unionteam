<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNION TEAM - Dashboard Officier</title>
    <style>
        :root {
            --bg-darker: #1e1f22; --bg-main: #2b2d31; --bg-preview: #313338;
            --text-white: #ffffff; --text-main: #dbdee1; --text-muted: #949ba4;
            --accent-discord: #5865f2; --success-green: #248046; --warning-orange: #f0b232; --danger: #f23f43;
        }

        body, html { margin: 0; padding: 0; height: 100%; font-family: "gg sans", sans-serif; background-color: var(--bg-main); color: var(--text-main); overflow: hidden; }
        header { background-color: var(--bg-darker); height: 70px; display: flex; align-items: center; justify-content: space-between; padding: 0 25px; border-bottom: 2px solid #1a1b1e; }
        
        .container { display: flex; height: calc(100% - 70px); }
        .editor-zone { flex: 1.1; background-color: var(--bg-darker); padding: 20px; overflow-y: auto; border-right: 1px solid #1a1b1e; }
        .preview-zone { flex: 0.9; background-color: var(--bg-preview); padding: 25px; overflow-y: auto; scroll-behavior: smooth; position: relative; }

        /* Style des blocs (Cards) */
        .module-card { background: #2b2d31; border-radius: 8px; padding: 18px; margin-bottom: 25px; border: 1px solid #3f4147; transition: 0.2s; }
        .module-card h3 { margin: 0 0 15px 0; font-size: 13px; color: var(--warning-orange); text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; gap: 8px; }
        
        /* Bloc Note Sp√©cifique */
        .notes-area { width: 100%; background: #1e1f22; border: 1px solid #1a1b1e; border-radius: 4px; color: #dbdee1; padding: 10px; font-family: inherit; font-size: 13px; resize: vertical; min-height: 100px; outline: none; box-sizing: border-box; }
        .notes-area:focus { border-color: var(--success-green); }

        .grid-inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
        .field { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 10px; font-weight: 800; color: var(--text-muted); text-transform: uppercase; }
        
        input { background: #1e1f22; border: 1px solid #1a1b1e; border-radius: 4px; padding: 8px; color: white; font-size: 13px; outline: none; }
        input:focus { border-color: var(--accent-discord); background: #232428; }

        .hl-active { background-color: rgba(240, 178, 50, 0.8) !important; color: black !important; font-weight: bold; border-radius: 3px; padding: 0 2px; }

        .btn-group { display: flex; gap: 8px; flex-wrap: wrap; }
        button { padding: 8px 14px; border-radius: 4px; border: none; font-weight: 600; cursor: pointer; font-size: 11px; display: flex; align-items: center; gap: 6px; transition: 0.2s; }
        .btn-blue { background-color: var(--accent-discord); color: white; }
        .btn-green { background-color: var(--success-green); color: white; }
        .btn-gray { background: #4f545c; color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--text-muted); color: var(--text-muted); }
        .btn-split { background: #eb459e; color: white; }

        .char-counter { position: sticky; top: -25px; background: var(--bg-preview); padding: 10px; font-weight: bold; border-bottom: 1px solid #4e5058; margin-bottom: 15px; z-index: 10; display: flex; justify-content: space-between; align-items: center; }
        .limit-ok { color: var(--success-green); }
        .limit-bad { color: var(--danger); }

        .discord-mockup { font-size: 15px; line-height: 1.5; white-space: pre-wrap; color: #dbdee1; padding-bottom: 100px; }
        .discord-mockup strong { color: #fff; }
        .discord-mockup hr { border: none; border-top: 1px solid #4e5058; margin: 25px 0; }

        #copy-toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--success-green); color: white; padding: 12px 25px; border-radius: 8px; opacity: 0; transition: 0.4s; z-index: 9999; pointer-events: none; font-weight: bold; }
        #expertMode { display: none; width: 100%; height: 80%; background: #232428; color: #dcddde; font-family: monospace; padding: 15px; border-radius: 8px; resize: none; border: 1px solid #1a1b1e; }
        
        #helpModal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 9000; }
        .modal-content { background: var(--bg-main); padding: 30px; border-radius: 12px; max-width: 500px; border: 1px solid #4e5058; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #1a1b1e; border-radius: 10px; }
    </style>
</head>
<body>

<header>
    <div style="font-weight: 800; color: white; font-size: 1.1rem;">üõ°Ô∏è UNION TEAM <span style="font-weight: 400; color: var(--text-muted);">OFFICER TOOLS</span></div>
    <div class="btn-group">
        <button class="btn-outline" onclick="toggleHelp()">‚ùì Aide</button>
        <button class="btn-gray" onclick="confirmReset()">üîÑ Reset Form</button>
        <div style="width: 2px; height: 30px; background: #4e5058; margin: 0 5px;"></div>
        <button class="btn-blue" id="btn-copy-full" onclick="copyAction('pure')">üöÄ Copier Annonce</button>
        <button class="btn-green" id="btn-share-full" onclick="copyAction('friend')">üë• Partager Code</button>
        <button class="btn-split" id="btn-p1" style="display:none" onclick="copySplit(1)">‚úÇÔ∏è Copier P1</button>
        <button class="btn-split" id="btn-p2" style="display:none" onclick="copySplit(2)">‚úÇÔ∏è Copier P2</button>
    </div>
</header>

<div class="container">
    <div class="editor-zone">
        
        <div id="recruitmentModule">
            <button id="toggleBtn" style="background:#4f545c; color:white; width:100%; padding:10px; margin-bottom:20px; border:1px dashed #949ba4; cursor:pointer; border-radius:4px; font-weight: bold;" onclick="toggleMode()">‚öôÔ∏è Passer en Mode Texte Libre</button>
            
            <div id="formMode">
                <div class="module-card" onfocusin="syncFocus('preview_gold')">
                    <h3>üî• UNION TEAM GOLD</h3>
                    <div class="grid-inputs">
                        <div class="field"><label>BDC</label><input type="text" id="g_bdc" data-base="UNM / NM / Brutal"></div>
                        <div class="field"><label>Hydre</label><input type="text" id="g_hy" data-base="Normal / Difficile / Brutal / Cauchemar"></div>
                        <div class="field"><label>Chim√®re</label><input type="text" id="g_ch" data-base="Difficile / Cauchemar / UNM"></div>
                        <div class="field"><label>CvC (RP/NRP)</label><input type="text" id="g_cvc" data-base="150k RP / 80k NRP"></div>
                        <div class="field"><label>Clash Hydre</label><input type="text" id="g_chy" data-base="650M"></div>
                        <div class="field"><label>Clash Chim√®re</label><input type="text" id="g_cch" data-base="500M"></div>
                        <div class="field"><label>Places</label><input type="text" id="g_pl" data-base="√† d√©terminer"></div>
                    </div>
                </div>

                <div class="module-card" onfocusin="syncFocus('preview_silver')">
                    <h3>‚öîÔ∏è UNION TEAM SILVER</h3>
                    <div class="grid-inputs">
                        <div class="field"><label>BDC</label><input type="text" id="s_bdc" data-base="UNM / NM"></div>
                        <div class="field"><label>Hydre</label><input type="text" id="s_hy" data-base="Normal / Difficile / Brutal"></div>
                        <div class="field"><label>Chim√®re</label><input type="text" id="s_ch" data-base="Facile / Difficile"></div>
                        <div class="field"><label>CvC (RP/NRP)</label><input type="text" id="s_cvc" data-base="100k RP / 50k NRP"></div>
                        <div class="field"><label>Clash Hydre</label><input type="text" id="s_chy" data-base="50M"></div>
                        <div class="field"><label>Clash Chim√®re</label><input type="text" id="s_cch" data-base=""></div>
                        <div class="field"><label>Places</label><input type="text" id="s_pl" data-base="√† d√©terminer"></div>
                    </div>
                </div>

                <div class="module-card" onfocusin="syncFocus('preview_savage')">
                    <h3>üî• UNION TEAM SAVAGE</h3>
                    <div class="grid-inputs">
                        <div class="field"><label>BDC</label><input type="text" id="sv_bdc" data-base="UNM / NM"></div>
                        <div class="field"><label>Hydre</label><input type="text" id="sv_hy" data-base="Normal / Difficile / Brutal / Cauchemar"></div>
                        <div class="field"><label>Chim√®re</label><input type="text" id="sv_ch" data-base="Difficile / Cauchemar"></div>
                        <div class="field"><label>CvC (RP/NRP)</label><input type="text" id="sv_cvc" data-base="80k RP / 50k NRP"></div>
                        <div class="field"><label>Clash Hydre</label><input type="text" id="sv_chy" data-base="80M"></div>
                        <div class="field"><label>Clash Chim√®re</label><input type="text" id="sv_cch" data-base="100M"></div>
                        <div class="field"><label>Places</label><input type="text" id="sv_pl" data-base="2 √† 3 places"></div>
                    </div>
                </div>

                <div class="module-card" onfocusin="syncFocus('preview_bronze')">
                    <h3>ü•â UNION TEAM BRONZE</h3>
                    <div class="grid-inputs">
                        <div class="field"><label>BDC</label><input type="text" id="b_bdc" data-base="UNM / NM / Brutal"></div>
                        <div class="field"><label>Hydre</label><input type="text" id="b_hy" data-base="Normal"></div>
                        <div class="field"><label>Chim√®re</label><input type="text" id="b_ch" data-base=""></div>
                        <div class="field"><label>CvC (RP/NRP)</label><input type="text" id="b_cvc" data-base="40k RP / 20k NRP"></div>
                        <div class="field"><label>Clash Hydre</label><input type="text" id="b_chy" data-base=""></div>
                        <div class="field"><label>Clash Chim√®re</label><input type="text" id="b_cch" data-base=""></div>
                        <div class="field"><label>Places</label><input type="text" id="b_pl" data-base="2 places dispo !"></div>
                    </div>
                </div>
            </div>
            <textarea id="expertMode" spellcheck="false" oninput="renderPreview()"></textarea>
        </div>

        <div class="module-card" id="notesModule">
            <h3>üìì NOTES PERSONNELLES (Local)</h3>
            <textarea id="userNotes" class="notes-area" placeholder="Notes de candidatures, rappels, objectifs..." oninput="saveNotes()"></textarea>
            <p style="font-size: 10px; color: var(--text-muted); margin-top: 5px;">* Ces notes sont enregistr√©es uniquement sur votre navigateur.</p>
        </div>

    </div>

    <div class="preview-zone">
        <div class="char-counter">
            <span>Taille Annonce : <span id="charCount">0</span> / 2000</span>
            <span id="limitStatus"></span>
        </div>
        <div id="visualPreview" class="discord-mockup"></div>
    </div>
</div>

<div id="helpModal">
    <div class="modal-content">
        <h2 style="color:white; margin-top:0;">üìñ Guide Officier</h2>
        <p>‚Ä¢ <b>Annonce</b> : Modifiez les cases, l'aper√ßu se met √† jour.</p>
        <p>‚Ä¢ <b>Note Perso</b> : Le bloc en bas √† gauche est votre espace priv√© (non partag√©).</p>
        <p>‚Ä¢ <b>Sauvegarde</b> : Tout est m√©moris√© sur ce PC automatiquement.</p>
        <button class="btn-blue" onclick="toggleHelp()" style="width:100%; justify-content:center; margin-top:10px;">Compris !</button>
    </div>
</div>

<div id="copy-toast">Copi√© !</div>

<script>
let currentMode = "form";
let activeFieldId = null;

const clanConfig = [
    { id: 'g', name: 'GOLD', emoji: ':fire:' },
    { id: 's', name: 'SILVER', emoji: ':crossed_swords:' },
    { id: 'sv', name: 'SAVAGE', emoji: ':fire:' },
    { id: 'b', name: 'BRONZE', emoji: ':third_place:' }
];

// --- GESTION ANNONCE ---
function build() {
    if(currentMode !== "form") return;
    const raw = generateContent(false);
    document.getElementById('expertMode').value = raw;
    const len = raw.replace("%%%SPLIT%%%", "").length;
    document.getElementById('charCount').innerText = len;
    
    if(len > 2000) {
        document.getElementById('charCount').className = 'limit-bad';
        document.getElementById('limitStatus').innerHTML = "‚ö†Ô∏è Scinder l'envoi";
        document.getElementById('btn-p1').style.display = 'flex';
        document.getElementById('btn-p2').style.display = 'flex';
    } else {
        document.getElementById('charCount').className = 'limit-ok';
        document.getElementById('limitStatus').innerHTML = "‚úÖ Ok Discord";
        document.getElementById('btn-p1').style.display = 'none';
        document.getElementById('btn-p2').style.display = 'none';
    }
    renderPreview(generateContent(true));
    saveData();
}

function generateContent(isHtml) {
    let t = `:dart: **[FR] L‚ÄôAlliance UNION TEAM Recrute !** :dart:\nNotre Union poss√®de **3 clans : Bronze ‚Üí Silver ‚Üí Gold**.\n\n`;
    clanConfig.forEach((c, idx) => {
        const f = {
            bdc: getVal(c.id+'_bdc', isHtml), hy: getVal(c.id+'_hy', isHtml), ch: getVal(c.id+'_ch', isHtml),
            cvc: getVal(c.id+'_cvc', isHtml), chy: getVal(c.id+'_chy', isHtml), cch: getVal(c.id+'_cch', isHtml), pl: getVal(c.id+'_pl', isHtml)
        };
        if(idx === 2) t += "%%%SPLIT%%%";
        t += `‚∏ª\n\n${c.emoji}** UNION TEAM ${c.name} **\n`;
        if(f.bdc) t += `:boom: BDC : ${f.bdc} ‚Üí tombent tous les jours\n`;
        if(f.hy)  t += `:dragon: **Hydre** : ${f.hy}\n`;
        if(f.ch)  t += `:smiling_imp: **Chim√®re** : ${f.ch} tombent\n`;
        t += `\n:heavy_check_mark: **Exigences :**\n`;
        if(c.id !== 'b') t += `‚Ä¢ Frapper **BDC UNM**\n`;
        if(f.cvc) t += `‚Ä¢ **${f.cvc}** en CvC\n`;
        if(f.chy) t += `‚Ä¢ Quotas Clash Hydre **${f.chy}**\n`;
        if(f.cch) t += `‚Ä¢ Quotas Clash Chim√®re **${f.cch}**\n`;
        t += (c.id === 'b') ? `‚Ä¢ Motivation Evolution\n` : `‚Ä¢ Activit√© Discord\n`;
        if(f.pl)  t += `:pushpin: ** Places **: ${f.pl}\n\n`;
    });
    t += `‚∏ª\n:envelope_with_arrow: **MP pour postuler !** :muscle:`;
    return isHtml ? t.replace("%%%SPLIT%%%", "") : t;
}

function getVal(id, isHtml) {
    const el = document.getElementById(id);
    if(!el) return null;
    const val = el.value.trim();
    if(!val) return null;
    return (isHtml && id === activeFieldId) ? `<span class="hl-active">${val}</span>` : val;
}

// --- GESTION NOTES ---
function saveNotes() {
    const noteText = document.getElementById('userNotes').value;
    localStorage.setItem('unionTeam_notes', noteText);
}

// --- UI & STOCKAGE ---
function saveData() {
    const allVals = {};
    document.querySelectorAll('input').forEach(i => allVals[i.id] = i.value);
    localStorage.setItem('unionTeam_save', JSON.stringify(allVals));
}

function copyAction(type) {
    let text = document.getElementById('expertMode').value.replace("%%%SPLIT%%%", "");
    if(type === 'friend') text = "```js\n" + text + "\n```";
    navigator.clipboard.writeText(text);
    showToast("Copi√© !");
}

function copySplit(part) {
    const parts = document.getElementById('expertMode').value.split("%%%SPLIT%%%");
    let textToCopy = (part === 1) ? parts[0] : "*(Suite)*\n" + parts[1];
    navigator.clipboard.writeText(textToCopy);
    showToast(`Partie ${part} copi√©e !`);
}

function renderPreview(rawText = null) {
    let content = rawText || document.getElementById('expertMode').value.replace("%%%SPLIT%%%", "");
    const emojiMap = { ":dart:":"üéØ", ":fire:":"üî•", ":boom:":"üí•", ":dragon:":"üêâ", ":smiling_imp:":"üòà", ":heavy_check_mark:":"‚úîÔ∏è", ":pushpin:":"üìå", ":crossed_swords:":"‚öîÔ∏è", ":third_place:":"ü•â", ":punch:":"üëä", ":gift:":"üéÅ", ":envelope_with_arrow:":"üì©", ":muscle:":"üí™" };
    let html = content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/‚∏ª/g, '<hr>');
    for (const [code, icon] of Object.entries(emojiMap)) { html = html.split(code).join(icon); }
    document.getElementById('visualPreview').innerHTML = html;
}

function confirmReset() { if(confirm("R√©initialiser le formulaire d'annonce ?")) applyDefaults(); }
function applyDefaults() { document.querySelectorAll('input').forEach(i => i.value = i.getAttribute('data-base') || ""); build(); }
function toggleMode() {
    const f = document.getElementById('formMode'), e = document.getElementById('expertMode'), b = document.getElementById('toggleBtn');
    if(currentMode === "form") { f.style.display = "none"; e.style.display = "block"; b.innerText = "üìù Formulaire"; currentMode = "expert"; }
    else { f.style.display = "block"; e.style.display = "none"; b.innerText = "‚öôÔ∏è Mode Texte"; currentMode = "form"; build(); }
}

function showToast(m) { const t = document.getElementById('copy-toast'); t.innerText = m; t.style.opacity = '1'; setTimeout(() => t.style.opacity = '0', 2000); }
function toggleHelp() { const m = document.getElementById('helpModal'); m.style.display = (m.style.display === 'flex') ? 'none' : 'flex'; }
function syncFocus(id) { document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'center' }); }

// --- INITIALISATION ---
document.querySelectorAll('input').forEach(input => {
    input.addEventListener('input', (e) => { activeFieldId = e.target.id; build(); });
    input.addEventListener('focus', (e) => { activeFieldId = e.target.id; build(); });
    input.addEventListener('blur', () => { activeFieldId = null; build(); });
});

window.onload = () => {
    // Load Recrutement
    const saved = localStorage.getItem('unionTeam_save');
    if (saved) {
        const data = JSON.parse(saved);
        for (const id in data) { if(document.getElementById(id)) document.getElementById(id).value = data[id]; }
        build();
    } else { applyDefaults(); }
    
    // Load Notes
    const savedNotes = localStorage.getItem('unionTeam_notes');
    if(savedNotes) { document.getElementById('userNotes').value = savedNotes; }
};
</script>
</body>
</html>