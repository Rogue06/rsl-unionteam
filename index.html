<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNION TEAM - Dashboard Officier Elite</title>
    <style>
        :root {
            --bg-darker: #1e1f22; --bg-main: #2b2d31; --bg-preview: #313338;
            --text-white: #ffffff; --text-main: #dbdee1; --text-muted: #949ba4;
            --accent: #5865f2; --success: #248046; --warning: #f0b232; --danger: #f23f43;
            --glass: rgba(255, 255, 255, 0.05);
        }

        body, html { margin: 0; padding: 0; height: 100%; font-family: "gg sans", "Inter", sans-serif; background-color: var(--bg-main); color: var(--text-main); overflow: hidden; }
        
        header { 
            background-color: var(--bg-darker); height: 70px; display: flex; align-items: center; justify-content: space-between; 
            padding: 0 25px; border-bottom: 2px solid #1a1b1e; z-index: 100;
        }

        .brand-group { display: flex; align-items: center; gap: 20px; }
        .logo-text { font-weight: 800; color: white; font-size: 1.1rem; letter-spacing: 0.5px; }

        .quick-note-nav {
            display: flex; align-items: center; gap: 8px; padding: 6px 14px; border-radius: 20px;
            background: var(--glass); border: 1px solid rgba(255,255,255,0.08); color: var(--text-muted);
            font-size: 11px; font-weight: 700; cursor: pointer; transition: 0.3s;
        }
        .quick-note-nav:hover { background: rgba(88, 101, 242, 0.15); color: white; border-color: var(--accent); }

        .container { display: flex; height: calc(100% - 70px); }
        .editor-zone { flex: 1.1; background-color: var(--bg-darker); padding: 25px; overflow-y: auto; border-right: 1px solid #1a1b1e; scroll-behavior: smooth; }
        .preview-zone { flex: 0.9; background-color: var(--bg-preview); padding: 25px; overflow-y: auto; position: relative; scroll-behavior: smooth; }

        .module-card { background: #2b2d31; border-radius: 8px; padding: 20px; margin-bottom: 25px; border: 1px solid #3f4147; transition: 0.3s; }
        .module-card h3 { margin: 0 0 15px 0; font-size: 13px; color: var(--warning); text-transform: uppercase; letter-spacing: 1px; }

        /* BLOC NOTES */
        .notes-container { 
            background: #111214; border: 1px solid #1a1b1e; border-radius: 8px; 
            display: flex; flex-direction: column; width: 100%; box-sizing: border-box;
            max-height: 500px;
        }
        .notes-toolbar { 
            background: #1e1f22; padding: 10px; border-bottom: 1px solid #1a1b1e; 
            display: flex; gap: 8px; align-items: center; flex-wrap: wrap; position: sticky; top: 0; z-index: 5;
        }
        .toolbar-btn {
            background: #2b2d31; border: 1px solid #3f4147; color: white; padding: 5px 10px; 
            border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 700; transition: 0.2s;
        }
        .toolbar-btn:hover { background: #4e5058; }

        #userNotes { 
            width: 100%; height: 350px; padding: 15px; color: #dbdee1; 
            font-size: 14px; outline: none; overflow-y: auto; box-sizing: border-box;
            background: transparent; line-height: 1.5;
        }
        #userNotes img { 
            max-width: 150px; max-height: 150px; border-radius: 4px; margin: 10px 0; 
            border: 2px solid transparent; cursor: zoom-in; transition: 0.2s;
        }
        #userNotes img:hover { border-color: var(--accent); transform: scale(1.02); }

        /* LIGHTBOX (Visionneuse) */
        #lightbox {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none;
            justify-content: center; align-items: center; z-index: 9999; cursor: zoom-out;
            animation: fadeIn 0.2s ease;
        }
        #lightbox img { max-width: 90%; max-height: 90%; border-radius: 8px; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* INPUTS */
        .grid-inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
        .field { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 10px; font-weight: 800; color: var(--text-muted); text-transform: uppercase; }
        input { background: #111214; border: 1px solid #1a1b1e; border-radius: 4px; padding: 10px; color: white; font-size: 13px; outline: none; }
        input::placeholder { color: #4e5058; font-style: italic; }
        .hl-active { background-color: rgba(240, 178, 50, 0.8) !important; color: black !important; font-weight: bold; border-radius: 3px; }

        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
        button { padding: 9px 16px; border-radius: 6px; border: none; font-weight: 600; cursor: pointer; font-size: 12px; }
        .btn-blue { background-color: var(--accent); color: white; }
        .btn-green { background-color: var(--success); color: white; }
        .btn-gray { background: #4f545c; color: white; }

        .discord-mockup { font-size: 15px; line-height: 1.5; white-space: pre-wrap; color: #dbdee1; padding-bottom: 100px; }
        .discord-mockup strong { color: #fff; }
        .discord-mockup hr { border: none; border-top: 1px solid #4e5058; margin: 25px 0; }
        .scroll-anchor { scroll-margin-top: 60px; display: block; height: 0; width: 0; }
        
        #copy-toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--success); color: white; padding: 12px 25px; border-radius: 30px; opacity: 0; transition: 0.4s; z-index: 9999; pointer-events: none; }
        .pulse-active { animation: pulse-note 1.5s ease-out; border-color: var(--accent) !important; }
        @keyframes pulse-note { 0% { box-shadow: 0 0 0 0 rgba(88, 101, 242, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(88, 101, 242, 0); } }
    </style>
</head>
<body>

<header>
    <div class="brand-group">
        <div class="logo-text">üõ°Ô∏è UNION TEAM</div>
        <div class="quick-note-nav" onclick="scrollToNotes()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
            NOTES
        </div>
    </div>
    <div class="btn-group">
        <button class="btn-gray" onclick="confirmReset()">üîÑ Reset Champs</button>
        <button class="btn-blue" onclick="copyAction('pure')">üöÄ Copier Tout</button>
        <button class="btn-green" onclick="copyAction('friend')">üë• Code Discord</button>
    </div>
</header>

<div class="container">
    <div class="editor-zone">
        
        <div id="formMode">
            <div class="module-card" onfocusin="syncFocus('preview_gold')">
                <h3>üî• UNION TEAM GOLD</h3>
                <div class="grid-inputs">
                    <div class="field"><label>BDC</label><input type="text" id="g_bdc" placeholder="UNM / NM / Brutal"></div>
                    <div class="field"><label>Hydre</label><input type="text" id="g_hy" placeholder="Normal / Brutal / Cauchemar"></div>
                    <div class="field"><label>Chim√®re</label><input type="text" id="g_ch" placeholder="Difficile / Cauchemar / UNM"></div>
                    <div class="field"><label>CvC (RP/NRP)</label><input type="text" id="g_cvc" placeholder="150k RP / 80k NRP"></div>
                    <div class="field"><label>Clash Hydre</label><input type="text" id="g_chy" placeholder="650M"></div>
                    <div class="field"><label>Clash Chim√®re</label><input type="text" id="g_cch" placeholder="500M"></div>
                    <div class="field"><label>Places</label><input type="text" id="g_pl" placeholder="√† d√©terminer"></div>
                </div>
            </div>

            <div class="module-card" onfocusin="syncFocus('preview_silver')">
                <h3>‚öîÔ∏è UNION TEAM SILVER</h3>
                <div class="grid-inputs">
                    <div class="field"><label>BDC</label><input type="text" id="s_bdc" placeholder="UNM & NM"></div>
                    <div class="field"><label>Hydre</label><input type="text" id="s_hy" placeholder="Normal / Brutal"></div>
                    <div class="field"><label>Chim√®re</label><input type="text" id="s_ch" placeholder="Facile & Difficile"></div>
                    <div class="field"><label>CvC (RP/NRP)</label><input type="text" id="s_cvc" placeholder="100k RP / 50k NRP"></div>
                    <div class="field"><label>Clash Hydre</label><input type="text" id="s_chy" placeholder="50M"></div>
                    <div class="field"><label>Places</label><input type="text" id="s_pl" placeholder="√† d√©terminer"></div>
                </div>
            </div>

            <div class="module-card" onfocusin="syncFocus('preview_savage')">
                <h3>üî• UNION TEAM SAVAGE</h3>
                <div class="grid-inputs">
                    <div class="field"><label>BDC</label><input type="text" id="sv_bdc" placeholder="UNM / NM"></div>
                    <div class="field"><label>Hydre</label><input type="text" id="sv_hy" placeholder="Tout tombe"></div>
                    <div class="field"><label>Chim√®re</label><input type="text" id="sv_ch" placeholder="Difficile & Cauchemar"></div>
                    <div class="field"><label>CvC (RP/NRP)</label><input type="text" id="sv_cvc" placeholder="80k RP / 50k NRP"></div>
                    <div class="field"><label>Clash Hydre</label><input type="text" id="sv_chy" placeholder="80M"></div>
                    <div class="field"><label>Clash Chim√®re</label><input type="text" id="sv_cch" placeholder="100M"></div>
                    <div class="field"><label>Places</label><input type="text" id="sv_pl" placeholder="2 √† 3 places dispo"></div>
                </div>
            </div>

            <div class="module-card" onfocusin="syncFocus('preview_bronze')">
                <h3>ü•â UNION TEAM BRONZE</h3>
                <div class="grid-inputs">
                    <div class="field"><label>BDC</label><input type="text" id="b_bdc" placeholder="UNM, NM & Brutal"></div>
                    <div class="field"><label>Hydre</label><input type="text" id="b_hy" placeholder="Normal"></div>
                    <div class="field"><label>CvC (RP/NRP)</label><input type="text" id="b_cvc" placeholder="40k RP / 20k NRP"></div>
                    <div class="field"><label>Places</label><input type="text" id="b_pl" placeholder="2 places dispo !"></div>
                </div>
            </div>
        </div>

        <div class="module-card" id="notesModule">
            <h3>üìì BLOC-NOTES OFFICIER</h3>
            <div class="notes-container">
                <div class="notes-toolbar">
                    <button class="toolbar-btn" onclick="execCmd('bold')">B</button>
                    <button class="toolbar-btn" onclick="execCmd('italic')">I</button>
                    <button class="toolbar-btn" onclick="toggleHighlight()">Highlight</button>
                    <button class="toolbar-btn" onclick="document.getElementById('imgInput').click()">üñºÔ∏è Image</button>
                    <input type="file" id="imgInput" style="display:none" accept="image/*" onchange="insertImage(this)">
                </div>
                <div id="userNotes" contenteditable="true" oninput="saveNotes()"></div>
            </div>
        </div>
    </div>

    <div class="preview-zone">
        <div id="visualPreview" class="discord-mockup"></div>
        <textarea id="expertMode" style="display:none"></textarea>
    </div>
</div>

<div id="lightbox" onclick="this.style.display='none'">
    <img src="" id="lightboxImg">
</div>

<div id="copy-toast">Copi√© !</div>

<script>
let activeFieldId = null;

function scrollToNotes() {
    const el = document.getElementById('notesModule');
    el.scrollIntoView({ behavior: 'smooth' });
    el.classList.remove('pulse-active');
    void el.offsetWidth;
    el.classList.add('pulse-active');
}

function syncFocus(id) {
    const target = document.getElementById(id);
    if(target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function execCmd(cmd, val = null) {
    document.execCommand(cmd, false, val);
    saveNotes();
}

function toggleHighlight() {
    const selection = window.getSelection();
    if (!selection.rangeCount) return;
    
    // Si la couleur de fond est d√©j√† jaune, on l'enl√®ve
    const parent = selection.anchorNode.parentElement;
    if (parent.style.backgroundColor === 'rgb(240, 178, 50)') {
        document.execCommand('hiliteColor', false, 'transparent');
    } else {
        document.execCommand('hiliteColor', false, '#f0b232');
    }
    saveNotes();
}

function insertImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = `<img src="${e.target.result}" onclick="openLightbox(this.src)">`;
            document.execCommand('insertHTML', false, img);
            saveNotes();
        };
        reader.readAsDataURL(input.files[0]);
    }
}

function openLightbox(src) {
    const lb = document.getElementById('lightbox');
    const img = document.getElementById('lightboxImg');
    img.src = src;
    lb.style.display = 'flex';
}

function saveNotes() { 
    localStorage.setItem('unionTeam_richNotes', document.getElementById('userNotes').innerHTML); 
}

function build() {
    const raw = generateContent(false);
    document.getElementById('expertMode').value = raw;
    renderPreview(generateContent(true));
    saveData();
}

function generateContent(isHtml) {
    let t = `:dart: **[FR] L‚ÄôAlliance UNION TEAM Recrute !** :dart:\n`;
    t += `Tu veux un clan actif, organis√©, avec une vraie bonne ambiance, des strats solides et une progression garantie ?\n`;
    t += `Notre Union poss√®de **3 clans : Bronze ‚Üí Silver ‚Üí Gold**, ce qui te permet d‚Äô√©voluer naturellement selon ton niveau et ton engagement.\n\n`;

    const sections = [
        {id:'g', name:'GOLD (Top niveau)', emoji:':fire:', hy:true, ch:true, chy:true, cch:true, power:false},
        {id:'s', name:'SILVER (Interm√©diaire)', emoji:':crossed_swords:', hy:true, ch:true, chy:true, cch:false, power:false},
        {id:'sv', name:'SAVAGE', emoji:':fire:', hy:true, ch:true, chy:true, cch:true, power:true},
        {id:'b', name:'BRONZE (Progression)', emoji:':third_place:', hy:true, ch:false, chy:false, cch:false, power:false}
    ];

    sections.forEach(s => {
        if(isHtml) t += `<span id="preview_${s.id === 'g' ? 'gold' : s.id === 's' ? 'silver' : s.id === 'sv' ? 'savage' : 'bronze'}" class="scroll-anchor"></span>`;
        t += `‚∏ª\n\n${s.emoji}** UNION TEAM ${s.name} **\n\n`;
        t += `:boom: BDC : ${getVal(s.id+'_bdc', isHtml)} ‚Üí tombent tous les jours\n`;
        if(s.hy) t += `:dragon: **Hydre** : ${getVal(s.id+'_hy', isHtml)} ${s.id === 'b' ? 'tombe' : '‚Üí tout tombe'}\n`;
        if(s.ch) t += `:smiling_imp:** Chim√®re** : ${getVal(s.id+'_ch', isHtml)} tombent \n`;
        if(s.id === 'b') t += `:punch: **Objectif** : faire tomber l‚ÄôUNM ensemble !\n`;
        
        t += `\n:heavy_check_mark: **Exigences :**\n\n`;
        if(s.power) t += `‚Ä¢ Puissance mini : 2M\n`;
        t += `‚Ä¢ Frapper **BDC UNM**${s.id === 'sv' ? ' & NM' : ''}\n`;
        if(getVal(s.id+'_cvc', false)) t += `‚Ä¢ **${getVal(s.id+'_cvc', isHtml)}** en CvC\n`;
        if(s.chy && getVal(s.id+'_chy', false)) t += `‚Ä¢ Quotas minimum Clash Hydre **${getVal(s.id+'_chy', isHtml)}** \n`;
        if(s.cch && getVal(s.id+'_cch', false)) t += `‚Ä¢ Quotas minimum Clash Chim√®re **${getVal(s.id+'_cch', isHtml)}** \n`;
        
        if(s.id === 'b') t += `‚Ä¢ Motivation pour monter vers **Silver**, puis **Gold**\n`;
        else t += `‚Ä¢ ${s.id === 's' ? 'Pr√©sence' : 'Activit√©'} Discord\n`;
        
        if(s.id === 'g' || s.id === 'sv') t += `:dart:** Ambiance chill + performance + bienveillance**\n`;
        t += `:pushpin: ** Place(s) disponible(s) **: ${getVal(s.id+'_pl', isHtml)}\n\n`;
    });

    t += `‚∏ª\n\n:gift: **Pourquoi nous rejoindre ?**\n\n`;
    t += `:heavy_check_mark: Une** communaut√© soud√©e**, mature et engag√©e\n`;
    t += `:heavy_check_mark: Des **strats partag√©es** en permanence\n`;
    t += `:heavy_check_mark: Un **Discord actif** : guides, coaching, aide, fun\n`;
    t += `:heavy_check_mark: Une vraie progression **de Bronze jusqu‚Äô√† Gold**\n\n`;
    t += `‚∏ª\n\n:envelope_with_arrow:** Int√©ress√©(e) ?**\nMP direct pour candidater ou poser tes questions.\nOn a h√¢te de t‚Äôaccueillir dans l‚ÄôUnion Team :muscle:`;
    return isHtml ? t : t;
}

function getVal(id, isHtml) {
    const el = document.getElementById(id);
    const val = el ? el.value.trim() : "";
    const finalVal = val || (el ? el.placeholder : "");
    return (isHtml && id === activeFieldId) ? `<span class="hl-active">${finalVal}</span>` : finalVal;
}

function renderPreview(content) {
    const emojiMap = { ":dart:":"üéØ", ":fire:":"üî•", ":boom:":"üí•", ":dragon:":"üêâ", ":smiling_imp:":"üòà", ":heavy_check_mark:":"‚úîÔ∏è", ":pushpin:":"üìå", ":crossed_swords:":"‚öîÔ∏è", ":third_place:":"ü•â", ":punch:":"üëä", ":gift:":"üéÅ", ":envelope_with_arrow:":"üì©", ":muscle:":"üí™" };
    let html = content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/‚∏ª/g, '<hr>');
    for (const [code, icon] of Object.entries(emojiMap)) { html = html.split(code).join(icon); }
    document.getElementById('visualPreview').innerHTML = html;
}

function saveData() {
    const vals = {};
    document.querySelectorAll('input[type="text"]').forEach(i => vals[i.id] = i.value);
    localStorage.setItem('unionTeam_save', JSON.stringify(vals));
}

function copyAction(type) {
    let text = document.getElementById('expertMode').value;
    if(type === 'friend') text = "```js\n" + text + "\n```";
    navigator.clipboard.writeText(text);
    showToast("Copi√© !");
}

function showToast(m) { 
    const t = document.getElementById('copy-toast'); t.innerText = m; t.style.opacity = '1'; 
    setTimeout(() => t.style.opacity = '0', 2000); 
}

function confirmReset() { 
    if(confirm("Vider tous les champs ?")) {
        document.querySelectorAll('input[type="text"]').forEach(i => i.value = "");
        build();
    }
}

document.querySelectorAll('input').forEach(input => {
    input.addEventListener('input', (e) => { activeFieldId = e.target.id; build(); });
    input.addEventListener('focus', (e) => { activeFieldId = e.target.id; build(); });
    input.addEventListener('blur', () => { activeFieldId = null; build(); });
});

window.onload = () => {
    const saved = localStorage.getItem('unionTeam_save');
    if (saved) {
        const data = JSON.parse(saved);
        for (const id in data) { if(document.getElementById(id)) document.getElementById(id).value = data[id]; }
    }
    const savedNotes = localStorage.getItem('unionTeam_richNotes');
    if(savedNotes) {
        document.getElementById('userNotes').innerHTML = savedNotes;
        // R√©attribuer l'√©v√©nement clic aux images charg√©es depuis la m√©moire
        document.querySelectorAll('#userNotes img').forEach(img => {
            img.onclick = () => openLightbox(img.src);
        });
    }
    build();
};
</script>
</body>
</html>